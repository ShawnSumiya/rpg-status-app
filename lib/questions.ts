export type QuestionCategory = "origins" | "adventure" | "abyss";

export type Question = {
  id: string;
  /** 質問文（RPG世界観） */
  text: string;
  /** 選択肢（どれもそれなりにありそうな行動） */
  options: string[];
  /** この質問が属するステージカテゴリ */
  category: QuestionCategory;
};

export type QuestionStage = {
  id: QuestionCategory;
  /** 英語タイトル（UI用） */
  title: string;
  /** 日本語サブタイトル */
  subtitle: string;
  /** ステージ説明文 */
  description: string;
  /** このステージに含まれる質問の開始インデックス（0-based, inclusive） */
  startIndex: number;
  /** このステージに含まれる質問の終了インデックス（0-based, inclusive） */
  endIndex: number;
};

// Stage 1 (Origins): 生まれと本能（幼少期や直感的な行動）
export const ORIGINS_QUESTIONS: Question[] = [
  {
    id: "q1",
    text: "幼いあなたは、村外れの森で小さなスライムに出会う。誰も見ていない。このスライムをどうする？",
    options: [
      "とりあえず連れて帰って、親に聞く",
      "経験値チャンスだと判断して叩く",
      "危険かもしれないので距離を保って観察する"
    ],
    category: "origins"
  },
  {
    id: "q2",
    text: "気付いたら見知らぬダンジョンで目覚めた幼少期のあなた。目の前には『怪しげな赤いボタン』がひとつだけ。どうする？",
    options: [
      "迷わず押してみる",
      "一度周囲をくまなく調べてから考える",
      "誰かが来るまでひたすら待つ"
    ],
    category: "origins"
  },
  {
    id: "q3",
    text: "子どもの頃、村の祭りで『無料ガチャ』を一回だけ引ける。景品一覧には当たりもハズレも混在。どのタイミングで引く？",
    options: [
      "人だかりができる前に、即座に引く",
      "他の人の結果を見て、ある程度傾向を読んでから引く",
      "最後まで様子を見て、余り物を逆に狙う"
    ],
    category: "origins"
  },
  {
    id: "q4",
    text: "幼いあなたは、王城の厨房で『食べてはいけないお菓子』を見つけてしまった。どう動く？",
    options: [
      "バレないように一個だけつまみ食いする",
      "自分では食べず、誰かが食べるのを期待して見守る",
      "真面目に大人に報告して自分の徳を積む"
    ],
    category: "origins"
  },
  {
    id: "q5",
    text: "初めて手に入れた『レアっぽい装備』。性能はよく分からないが、光っている。どうする？",
    options: [
      "細かいことは気にせず、とりあえず装備",
      "情報が集まるまで倉庫にしまっておく",
      "誰かに高く売れないか、相場を聞いて回る"
    ],
    category: "origins"
  },
  {
    id: "q6",
    text: "クラスメイトが『秘密基地』を作ろうと言い出した。あなたの立ち位置は？",
    options: [
      "率先して場所を決め、ルールも仕切るリーダー役",
      "道具を用意したり、サポートに徹する参謀役",
      "外から様子を見つつ、面白そうなときだけ参加する"
    ],
    category: "origins"
  },
  {
    id: "q7",
    text: "子どもの頃、理不尽に怒る大人NPCに出会った。あなたはどう反応していたと思う？",
    options: [
      "納得いかなくても表面上は謝ってやり過ごす",
      "理屈で反論しようとしてさらに怒られる",
      "聞いていないフリをして、自分の世界に逃げる"
    ],
    category: "origins"
  },
  {
    id: "q8",
    text: "幼いあなたは、皆がやりたがらない掃除クエストを押し付けられた。どうする？",
    options: [
      "一人で黙々と終わらせてしまう",
      "交渉して、見返りや報酬を取りつける",
      "最低限だけやって、あとはバレないようにサボる"
    ],
    category: "origins"
  },
  {
    id: "q9",
    text: "クラスで『人気者パーティ』と『地味だけど安定したパーティ』に誘われた。子どものあなたはどちらを選びそう？",
    options: [
      "トラブル覚悟で人気者パーティに入る",
      "安定志向で地味パーティに入る",
      "どちらにも所属せず、ソロで動く"
    ],
    category: "origins"
  },
  {
    id: "q10",
    text: "初めてのおこづかいクエスト。もらった瞬間のあなたの行動は？",
    options: [
      "その足でずっと欲しかった物を即購入",
      "しばらく温存して、使い道をじっくり検討する",
      "『とりあえず貯金』と言いながら、気付いたらなくなっている"
    ],
    category: "origins"
  },
  {
    id: "q31",
    text: "初めて入った酒場で、大人たちが小競り合いを始めた。幼いあなたは？",
    options: [
      "安全な場所に退避しつつ、状況を冷静に観察する",
      "店主や大人に知らせて、早めに火消しを図る",
      "面白そうなので、どさくさに紛れて情報を拾いに行く"
    ],
    category: "origins"
  },
  {
    id: "q32",
    text: "魔法学校の入学試験で、杖から予想外の魔法が暴発した。あなたのリアクションは？",
    options: [
      "とりあえず場を笑いに変えようと、ネタとして乗り切る",
      "即座に謝罪しつつ、原因を論理的に説明し始める",
      "心の中で『二度と人前で魔法なんて撃つか』と誓う"
    ],
    category: "origins"
  },
  {
    id: "q33",
    text: "幼少期、クラスで『誰もやりたがらない主人公役』に抜擢された。どうする？",
    options: [
      "せっかくなので全力でなりきり、主役として振る舞う",
      "仕方なく受けつつ、できるだけ無難にこなす",
      "丁重に断り、裏方ポジションを確保しようとする"
    ],
    category: "origins"
  },
  {
    id: "q34",
    text: "村の噂話で『夜中にだけ開く不思議な屋台』の話を聞いた。子どものあなたは？",
    options: [
      "友だちを誘って、ワクワクしながら夜中に見に行く",
      "怖いので行かないが、行った人の話は根掘り葉掘り聞く",
      "そもそも噂話自体を信じず、普通に寝る"
    ],
    category: "origins"
  }
];

// Stage 2 (Adventure): 冒険と対人（仕事や人間関係のスタンス）
export const ADVENTURE_QUESTIONS: Question[] = [
  {
    id: "q11",
    text: "王様から『理不尽な無茶ぶりクエスト』が下された。期限も報酬もあいまい。まず何をする？",
    options: [
      "とりあえず受けてから、条件交渉を始める",
      "受注前にリスクとリターンを徹底的に確認する",
      "危険を察知し、他のパーティに様子見を依頼する"
    ],
    category: "adventure"
  },
  {
    id: "q12",
    text: "パーティメンバーの一人が、明らかにサボっている。あなたの対応は？",
    options: [
      "はっきり指摘して改善を求める",
      "表面上は合わせつつ、自分の負担を減らす方向で調整する",
      "直接は言わず、別のメンバーと陰で愚痴る"
    ],
    category: "adventure"
  },
  {
    id: "q13",
    text: "職場ギルドで『面倒くさい飲み会クエスト』が発動。あなたのスタンスは？",
    options: [
      "人脈も経験値だと割り切って参加する",
      "最低限の時間だけ顔を出して早めに退散する",
      "体調不良などのステータス異常を理由にそっと断る"
    ],
    category: "adventure"
  },
  {
    id: "q14",
    text: "ダンジョン攻略中、明らかに罠っぽい『美味しすぎる話』を持ちかけられた。どうする？",
    options: [
      "多少のリスクは承知で乗ってみる",
      "情報が足りないので、一度持ち帰って検討する",
      "その場で即座に断り、距離を置く"
    ],
    category: "adventure"
  },
  {
    id: "q15",
    text: "あなたの提案がパーティ会議でスルーされた後、別のメンバーがほぼ同じ案を出して称賛された。どう動く？",
    options: [
      "その場で『それ、さっきも言ったけど』とツッコむ",
      "モヤモヤしながらも、場の空気を壊さないように黙る",
      "心のメモに刻み、今後の距離感調整に使う"
    ],
    category: "adventure"
  },
  {
    id: "q16",
    text: "ギルドで明らかに実力不足な新人が、無謀な高難度クエストに志願している。あなたはどうする？",
    options: [
      "止めつつ、自分がフォローに入ることを提案する",
      "危険だとだけ伝え、あとは本人の判断に任せる",
      "見て見ぬふりをして、自分のクエストに集中する"
    ],
    category: "adventure"
  },
  {
    id: "q17",
    text: "長年組んできた相棒が、より条件の良い別パーティへの移籍を考えていると言う。あなたの反応は？",
    options: [
      "本音で寂しいと伝えつつ、応援する",
      "感情を抑え、ビジネスライクに送り出す",
      "裏切りと感じ、距離を置く・縁を切る方向に傾く"
    ],
    category: "adventure"
  },
  {
    id: "q18",
    text: "職場ギルドで成果を上げたのに、評価されたのはなぜか別のメンバー。どう捉える？",
    options: [
      "悔しいが、次はもっと目立つ形で成果を出そうと燃える",
      "『そういうものだ』と割り切りつつ、静かに不信感を貯める",
      "こんなギルドに長居しても無駄だと、転職クエストを検討し始める"
    ],
    category: "adventure"
  },
  {
    id: "q19",
    text: "パーティ内で価値観の大きな衝突が発生。多数派と少数派に分かれ、あなたは少数派側。どう動く？",
    options: [
      "論理的に説得し、形勢逆転を狙う",
      "多数派に合わせつつ、自分のスタイルは密かに守る",
      "いっそパーティを離脱し、新天地を探す"
    ],
    category: "adventure"
  },
  {
    id: "q20",
    text: "気になる相手（恋愛対象）が、あなたのパーティに加入した。どんな立ち回りをしがち？",
    options: [
      "アピールがバレない範囲で、さりげなく活躍しようとする",
      "普段よりも距離を取り、冷静さを装う",
      "テンションが上がりすぎて、空回りコンボを発動しがち"
    ],
    category: "adventure"
  },
  {
    id: "q35",
    text: "酒場でパーティメンバー同士が口論を始めた。決定的な殴り合いになる前に、あなたは？",
    options: [
      "場を仕切ってルールを決め、冷静な話し合いに持ち込む",
      "どちらの味方もせず、第三者として状況を茶化しつつ和ませる",
      "深入りすると面倒なので、静かに席を外す"
    ],
    category: "adventure"
  },
  {
    id: "q36",
    text: "宝箱の前で『分配どうする問題』が勃発。あなたの基本スタンスは？",
    options: [
      "最初にルールを明文化し、公平な分配システムを提案する",
      "その場の空気を読みつつ、自分が損しないラインで折り合う",
      "面倒なので、最初から自分の取り分は最低限でいいと宣言する"
    ],
    category: "adventure"
  },
  {
    id: "q37",
    text: "ギルドの同僚が、明らかに危険な恋愛イベントに突っ込もうとしている。あなたは？",
    options: [
      "止めつつ、具体的なリスクと代替案を丁寧に示す",
      "『まあ経験値にはなるでしょ』と軽く忠告だけして見守る",
      "そっと距離を取り、自分が巻き込まれないようにする"
    ],
    category: "adventure"
  },
  {
    id: "q38",
    text: "長年所属していたギルドに、明らかにヤバそうな新しい上司NPCが着任した。あなたの初動は？",
    options: [
      "まずは情報収集しつつ、うまく使えるポイントを探る",
      "表向きは従いつつ、水面下で転職クエストの準備を進める",
      "我関せずを貫き、直接の接触を極力避ける"
    ],
    category: "adventure"
  }
];

// Stage 3 (Abyss): 深淵と試練（ストレス耐性や隠された欠点）
export const ABYSS_QUESTIONS: Question[] = [
  {
    id: "q21",
    text: "長期ダンジョン攻略の終盤、全員が疲弊している中で、もう一層だけ進むかどうかの判断を迫られた。あなたは？",
    options: [
      "多少無理してでも、今の勢いで押し切るべきと判断する",
      "撤退も選択肢として真剣に検討し、リスクを天秤にかける",
      "多数派の意見に合わせ、自分の本音は飲み込む"
    ],
    category: "abyss"
  },
  {
    id: "q22",
    text: "信頼していた仲間に、重要な場面で裏切られた。あなたの心の動きに一番近いのは？",
    options: [
      "怒りよりも『やっぱりそうなるよな』という諦めが先に来る",
      "裏切られた理由を徹底的に分析し、自分の非も探し始める",
      "強い怒りを覚え、一度許さないと決めたら長く根に持つ"
    ],
    category: "abyss"
  },
  {
    id: "q23",
    text: "大きな失敗クエストの後、あなたはどうやってメンタルを立て直す？",
    options: [
      "すぐに次のクエストで成功体験を上書きしようとする",
      "一度立ち止まり、原因分析と自己反省をじっくり行う",
      "何もしないまま時間だけが過ぎ、自然消滅に期待する"
    ],
    category: "abyss"
  },
  {
    id: "q24",
    text: "心身ともに限界が近いのに、周囲からは『まだいけるでしょ？』と言われ続けている。あなたの行動は？",
    options: [
      "限界でも無理をしてしまい、後で大きく崩れる",
      "表面上は笑いながら、裏で少しずつ負担を減らす工夫をする",
      "あるラインを超えた瞬間、突然全部を手放して姿を消す"
    ],
    category: "abyss"
  },
  {
    id: "q25",
    text: "強大なボス戦で、自分のミスがきっかけで全滅しかけた。直後のあなたの内面に近いのは？",
    options: [
      "すぐに謝りつつ、次の立て直し案を必死で考える",
      "『自分がいない方がいいのでは』という思考がよぎる",
      "心の中で言い訳と自己防衛がフル回転する"
    ],
    category: "abyss"
  },
  {
    id: "q26",
    text: "長年追い続けてきた『夢クエスト』を諦めるかどうかの岐路に立っている。あなたの判断軸は？",
    options: [
      "損得よりも、『まだ心が燃えるか』を基準に決める",
      "現実的な生活や安定度を優先してシビアに判断する",
      "決断を先延ばしにし、曖昧な状態を維持しがち"
    ],
    category: "abyss"
  },
  {
    id: "q27",
    text: "誰も見ていない場所で、禁断の『ステータス書き換えの書』を手に入れた。使えば都合の悪い部分をなかったことにできる。どうする？",
    options: [
      "一瞬迷うが、自分の欠点も含めて今の自分だと考え直す",
      "少しだけ、バレない範囲で都合よく書き換える",
      "迷わず大幅に書き換え、別人としてやり直す選択を取る"
    ],
    category: "abyss"
  },
  {
    id: "q28",
    text: "強制イベントで『過去のトラウマダンジョン』に再訪することになった。あなたの向き合い方は？",
    options: [
      "今度こそクリアしてやると、復讐心まじりに燃える",
      "淡々と攻略しつつ、必要以上に感情を動かさないようにする",
      "何か理由をつけて、できれば誰かに代わりに行ってほしいと思う"
    ],
    category: "abyss"
  },
  {
    id: "q29",
    text: "世界の命運がかかった最終選択肢。『自分の幸福』と『世界の安定』がトレードオフになっている。直感的にどちらに傾きやすい？",
    options: [
      "世界よりも、まず自分と身近な人の幸福を優先したい",
      "自分を犠牲にしてでも、大勢の安定を選びがち",
      "そもそもその二択の前提自体を疑い、第三の選択肢を探す"
    ],
    category: "abyss"
  },
  {
    id: "q30",
    text: "この冒険の書に、あなた自身の性格を一言で刻むとしたら、どの方向性が一番しっくりくる？",
    options: [
      "不器用だが、どこか憎めない人間臭い主人公タイプ",
      "影の多い頭脳派・裏方ポジションに落ち着きがちなタイプ",
      "どのパーティにも完全には馴染まない、流浪のソロプレイヤータイプ"
    ],
    category: "abyss"
  },
  {
    id: "q39",
    text: "呪われた宝箱の罠で、一度だけ『誰か一人だけ助かる』状況に放り込まれた。あなたの思考に近いのは？",
    options: [
      "最も生存確率が高いメンバーを冷静に選ぶ",
      "自分が生贄になる未来をまず想像してしまう",
      "そもそもその二択を拒否し、ルールの穴を探そうとする"
    ],
    category: "abyss"
  },
  {
    id: "q40",
    text: "長期遠征の途中で、こっそりサボって街に戻るメンバーを目撃した。あなたは？",
    options: [
      "事情を聞いたうえで、必要ならこっそりフォローする",
      "ギルドに報告するかどうかを、メリット・デメリットで天秤にかける",
      "見なかったことにして、自分も次にサボるタイミングを計算する"
    ],
    category: "abyss"
  },
  {
    id: "q41",
    text: "魔王討伐後、世界は一応平和になったが、自分の心の虚無感が消えない。あなたはどう動く？",
    options: [
      "新しい目標や敵を探しに、別の大陸へ旅立つ",
      "平和な日常の中で、自分なりの小さな役割を探す",
      "表向きは普通に暮らしつつ、心の中では常に次のカタストロフを待っている"
    ],
    category: "abyss"
  },
  {
    id: "q42",
    text: "『この世界はゲームかもしれない』という説を聞いたとき、あなたの反応に近いのは？",
    options: [
      "だったらせめてバグ技と隠しルートを研究したい",
      "ゲームでも現実でも、今感じる痛みは本物だから関係ないと思う",
      "セーブ&ロードができない時点でクソゲーだと内心毒づく"
    ],
    category: "abyss"
  }
];

/** 質問プール（40問以上）をひとまとめにした配列（フロント・API双方で使用） */
export const questionsPool: Question[] = [
  ...ORIGINS_QUESTIONS,
  ...ADVENTURE_QUESTIONS,
  ...ABYSS_QUESTIONS
];

// 互換用エイリアス（必要があれば使用）
export const ALL_QUESTIONS: Question[] = questionsPool;

export const QUESTION_STAGES: QuestionStage[] = [
  {
    id: "origins",
    title: "Stage 1: Origins",
    subtitle: "生まれと本能",
    description: "幼少期の選択や、本能レベルのリアクションから『地の性格ステータス』を掘り起こすステージ。",
    startIndex: 0,
    endIndex: ORIGINS_QUESTIONS.length - 1
  },
  {
    id: "adventure",
    title: "Stage 2: Adventure",
    subtitle: "冒険と対人",
    description: "仕事・人間関係・恋愛など、他人と関わるときのスタンスや癖が丸見えになるステージ。",
    startIndex: ORIGINS_QUESTIONS.length,
    endIndex: ORIGINS_QUESTIONS.length + ADVENTURE_QUESTIONS.length - 1
  },
  {
    id: "abyss",
    title: "Stage 3: Abyss",
    subtitle: "深淵と試練",
    description: "ストレス限界時の挙動や、本人も直視したくない欠点ゾーンをえぐるラストステージ。",
    startIndex: ORIGINS_QUESTIONS.length + ADVENTURE_QUESTIONS.length,
    endIndex:
      ORIGINS_QUESTIONS.length +
      ADVENTURE_QUESTIONS.length +
      ABYSS_QUESTIONS.length -
      1
  }
];
/**
 * 1回の診断で回答してもらう質問数。
 * 実際には questionsPool のプールから、この数だけランダム抽選して使用する。
 */
export const TOTAL_QUESTION_COUNT = 20;

export function getStageByCategory(
  category: QuestionCategory
): QuestionStage {
  return (
    QUESTION_STAGES.find((stage) => stage.id === category) ??
    QUESTION_STAGES[0]
  );
}

/**
 * 固定のラスト質問。
 * 診断結果の受け止め方（覚悟ゲージ）を測る、儀式的な最終問い。
 */
export const finalQuestion: Question = {
  id: "final",
  text: "最後の問いだ。この診断結果がどれほど残酷でも、お前は自らの運命（ステータス）を受け入れる覚悟があるか？",
  options: [
    "当然だ（運命を受け入れる）",
    "文句は言うかもしれない（人間だもの）",
    "結果を見てから決める（ご都合主義）"
  ],
  // 儀式感の強い「深層心理・闇」寄りとして扱う
  category: "abyss"
};

/**
 * 質問プールからランダムに (count - 1) 問を取り出し、
 * 最後に必ず finalQuestion を結合して合計 count 問の配列を返す。
 */
export function getRandomQuestions(count: number): Question[] {
  const coreCount = Math.max(
    0,
    Math.min(count - 1, questionsPool.length)
  );

  const pool = [...questionsPool];
  // Fisher-Yates シャッフル
  for (let i = pool.length - 1; i > 0; i -= 1) {
    const j = Math.floor(Math.random() * (i + 1));
    [pool[i], pool[j]] = [pool[j], pool[i]];
  }

  const selected = pool.slice(0, coreCount);
  return [...selected, finalQuestion];
}

